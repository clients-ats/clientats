# Pre-commit hooks configuration for ClientATS
# Install: pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Elixir formatting and linting
  - repo: local
    hooks:
      - id: mix-format
        name: mix format
        entry: bash -c 'mix format'
        language: system
        types: [elixir]
        pass_filenames: false
        stages: [commit]

      - id: mix-credo
        name: mix credo
        entry: bash -c 'mix credo --strict'
        language: system
        types: [elixir]
        pass_filenames: false
        stages: [commit]
        verbose: true

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: end-of-file-fixer
        name: Fix end of file
      - id: trailing-whitespace
        name: Trim trailing whitespace
      - id: check-yaml
        name: Check YAML syntax
      - id: check-json
        name: Check JSON syntax
      - id: check-merge-conflict
        name: Check merge conflicts
      - id: detect-private-key
        name: Detect private keys

  # YAML validation
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.32.0
    hooks:
      - id: yamllint
        name: Lint YAML
        args: [--strict]
        files: |
          (?x)^(
            \.github/workflows/.*\.ya?ml|
            docker-compose\.ya?ml|
            k8s/.*\.ya?ml
          )$

  # Docker linting
  - repo: https://github.com/hadialqattan/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        name: Check Dockerfile style
        entry: bash -c 'if [ -f Dockerfile ]; then docker run --rm -i hadolint/hadolint < Dockerfile; fi'
        language: system
        files: Dockerfile
        pass_filenames: false

  # Commit message linting
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v3.12.0
    hooks:
      - id: commitizen
        name: Check commit message format
        stages: [commit-msg]
